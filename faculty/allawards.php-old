<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Chemistry Awards System - University of Michigan</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<META content="" name=KEYWORDS>
<META content="" name=description>
<link rel="stylesheet" href="../eebstyle.css">
</head>

<body>
<div class="bodypad">
<div align="center"><br>
<div class="facrecbox1"><div class="textalignleft pad15and10">
<div align="center"><br><br><h1>Faculty Awards<br></h1><br>
</div>
<?php 
require_once('../dbConnect.inc'); 
require_once('nav.php');
?>

<div align="center">
<?
 
$sqlsearch = "SELECT `id`, `type`, `ACS_cluster`, `Award_Name`, `Due_year`, Due_Month, date_add(date_add(makedate(due_year, 1), interval (month(str_to_date(left(due_month, 3),'%b')) - 1) MONTH), interval ((due_day)-1) DAY) as due_date,`Awarded_By`, `Link_to_Website`, `Description`, `eligibility`, `tags`, `comments` FROM `awards_descr`";

if (isset($_POST[submit])) {

     $type = check_input($_REQUEST['type']);
     $due_year = check_input($_REQUEST['due_year']);
     $due_month = check_input($_REQUEST['due_month']);
     $eligable = check_input($_REQUEST['eligable']);

     $where = ' where 1';
     if ($type !== 'none' ) { $where .= " and type = '" . $type . "'"; }
     if ($due_year !== 'none' ) { $where .= " and due_year = '" . $due_year . "'"; }
     if ($due_month !== 'none' ) { $where .= " and due_month = '" . $due_month . "'"; }
     if ($eligable !== 'none' ) { $where .= " and who_is_eligible = '" . $eligable . "'"; }

     $sqlsearch =  $sqlsearch . $where;
//echo $sqlsearch;
//exit;

}
    echo "<form name='form2' method='post' action='allawards.php'>";
    echo "Search:";
    $sql = "SELECT DISTINCT type FROM awards_descr";
    $result = mysql_query($sql) or die("Query failed :".mysql_error());
    echo "<br>Type:";
    echo "<select name='type'>";
        echo "<option select value='none'> - choose type -</option>";
        while ($typelist = mysql_fetch_array($result))
        {
           echo "<option";
           if ($typelist[type] == $type) { echo " selected"; } 
           echo " value=$typelist[type]>$typelist[type]</option>";
        }
    echo "</select><br>";

    $sql = "SELECT DISTINCT due_year FROM awards_descr ORDER BY due_year";
    $result = mysql_query($sql) or die("Query failed :".mysql_error());
    echo "<br>Year:";
    echo "<select name='due_year'>";
        echo "<option select value='none'> - choose year -</option>";
        while ($years = mysql_fetch_array($result))
        {
           echo "<option";
           if ($years[due_year] == $due_year) { echo " selected"; } 
            echo " value=$years[due_year]>$years[due_year]</option>";
        }
    echo "</select><br>";

    $sql = "SELECT DISTINCT due_month FROM awards_descr ORDER BY due_month";
    $result = mysql_query($sql) or die("Query failed :".mysql_error());
    echo "<br>Month:";
    echo "<select name='due_month'>";
        echo "<option select value='none'> - choose month -</option>";
        while ($months = mysql_fetch_array($result))
        {
           echo "<option";
           if ($months[due_month] == $due_month) { echo " selected"; } 
                echo " value=$months[due_month]>$months[due_month]</option>";
        }
    echo "</select><br>";

    $sql = "SELECT id, name FROM eligibility_list ORDER BY name";
    $result = mysql_query($sql) or die("Query failed :".mysql_error());
    echo "<br>Eligibility:";
    echo "<select name='eligable'>";
        echo "<option select value='none'> - choose  -</option>";
        while ($eligibility = mysql_fetch_array($result))
        {
           echo "<option";
           if ($eligibility[id] == $eligable) { echo " selected"; } 
           echo " value=$eligibility[id]>$eligibility[name]</option>";
        }
    echo "</select><br><br>";
?>

       <input type="submit" name="submit" value="Search">
        </form>
<?echo "<form name='form2' action='edit_award.php' method='post'>";
echo ('<td> <input type="submit" name="add" value="Add a New Award"></td>');
 echo('</form></td>');
?>

<table>

<?php 



 $result = mysql_query($sqlsearch) or header('Location: ERROR.php?error="Unable to select to applicants for full listing."');
$total=mysql_num_rows($result);
?>
<?php

 
 if( $total == 0 )
 {
    echo "<br><br>There were no results found. <Br>";
 }//if
 else  {
     echo "<Strong>Total:</Strong> ".$total;

echo "<Br><Br>";
 //show table headers for results
 
echo ("
<tr>
	<th><a href=\"allawards.php?&sort=id\"></a>id</th>
	<th>Edit Award</th>
	<th><a href=\"allawards.php?&sort=type\">type</a></th>
	<th><a href=\"allawards.php?&sort=ACS_cluster\">ACS_cluster</a></th>
	<th>Award_Name</a></th>
	<th><a href=\"allawards.php?&sort=Due_Month\">Due_Date</a></th>
	<th><a href=\"allawards.php?&sort=Awarded_By\">Awarded_By</a></th>
	<th>Description</th>
	<th>eligibility</th>

</tr>
");
}//else

while ( $adata = mysql_fetch_array($result) ) 
{
	

	echo ("<tr>");
		
		echo"<td><a href='award.php?id=$adata[id]'><b>$adata[id]</b></a></td>";
		echo"<td><a href='edit_award.php?id=$adata[id]'>Edit <b>$adata[id]</b></a></td>";
		echo "<td>$adata[type]</td>";
		echo "<td>$adata[ACS_cluster]</td>";
		echo "<td><a href='$adata[Link_to_Website]' target='_blank'>$adata[Award_Name]</td>";
		echo "<td>$adata[due_date]</td>";
		echo "<td>$adata[Awarded_By]</td>";
    $descr = $adata[Description];
    $elig = $adata[eligibility];
//echo $descr;
    $descr = preg_replace("/\r?\n/", "\\n", addslashes($descr));
    $elig = preg_replace("/\r?\n/", "\\n", addslashes($elig));
//    $descr = preg_replace('/([?#^&*()$\\/])/', '\\\\$1', $descr);
//echo $descr;

?>
<td>
   <button onclick="open_win('Description', '<?= $descr ?>')">Open</button>

</td>

<td>
   <button onclick="open_win('Eligibility', '<?= $elig ?>')">Open</button>
</td>

<?	
	print ("</tr>");
//exit;
} //while
?>

 </table> 
  
<script>
function open_win(name, text) {
    window.open('youPopUpPage.php?text=' + text + '&name=' + name, '_blank','toolbar=0,location=no,menubar=0,height=400,width=400,left=200, top=300');
}
</script>
 </table>
<bR><div align="center"><img src="images/linecalendarpopup500.jpg"></div><Br>

</body>
</html>

